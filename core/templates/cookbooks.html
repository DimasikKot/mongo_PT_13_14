{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2>Кулинарные книги</h2>

    <a href="/cookbook/add/" class="md-button">Добавить книгу</a>

    <div style="margin-top: 24px; display: grid; gap: 20px;">
    {% for c in cookbooks %}
        <div class="item-card">
            <h3 style="margin: 0 0 12px 0;">{{ c.cookbook_name }}</h3>

            <div>
                <strong>Рецепты:</strong>
                {% if c.recipes %}
                <ul style="margin: 8px 0; padding-left: 20px;">
                    {% for r in c.recipes %}
                        <li>{{ r.title }} ({{ r.cooking_time_minutes }} мин)</li>
                    {% endfor %}
                </ul>
                {% else %}
                    <span style="color: #757575;">Рецептов нет</span>
                {% endif %}
            </div>

            <div style="margin-top: 16px;">
                <a href="/cookbook/update/{{ c.id }}/" class="md-button secondary">Редактировать</a>
                <button type="button" 
                        class="md-button secondary delete-btn" 
                        style="margin-left: 8px;" 
                        data-id="{{ c.id }}" 
                        data-name="{{ c.cookbook_name }}">
                    Удалить
                </button>
            </div>
        </div>
    {% empty %}
        <p style="text-align: center; color: #757575;">Кулинарных книг пока нет</p>
    {% endfor %}
    </div>
</div>

<!-- Модальное окно подтверждения удаления -->
<div id="deleteModal" class="modal" style="display: none;">
    <div class="modal-content">
        <h3>Подтвердите удаление</h3>
        <p>Вы уверены, что хотите удалить книгу <strong id="modalCookbookName"></strong>?</p>
        <div style="margin-top: 24px; text-align: right;">
            <button type="button" id="cancelDelete" class="md-button secondary">Отмена</button>
            <form id="deleteForm" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="md-button secondary" style="margin-left: 8px; color: #d32f2f;">Удалить</button>
            </form>
        </div>
    </div>
</div>

<div id="modalBackdrop" class="modal-backdrop" style="display: none;"></div>

<style>
    .item-card {
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 20px;
        background: var(--md-card-bg, #fff);
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        transition: box-shadow 0.2s;
    }
    .item-card:hover {
        box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }

    .md-button.secondary {
        color: #9333ea !important;
    }
    .md-button.secondary:hover {
        color: #7c2ac7 !important;
        text-decoration: underline;
    }

    .modal-backdrop {
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
    }
    .modal {
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        z-index: 1001; display: flex;
        align-items: center; justify-content: center;
    }
    .modal-content {
        background: var(--md-card-bg, #fff);
        border-radius: 12px; padding: 24px;
        width: 90%; max-width: 420px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }
</style>

<script>
    const modal = document.getElementById('deleteModal');
    const backdrop = document.getElementById('modalBackdrop');
    const cancelBtn = document.getElementById('cancelDelete');
    const deleteForm = document.getElementById('deleteForm');
    const cookbookNameSpan = document.getElementById('modalCookbookName');

    document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            const name = this.getAttribute('data-name');

            cookbookNameSpan.textContent = name;
            deleteForm.action = `/cookbook/delete/${id}/`;

            modal.style.display = 'flex';
            backdrop.style.display = 'block';
        });
    });

    function closeModal() {
        modal.style.display = 'none';
        backdrop.style.display = 'none';
    }

    cancelBtn.addEventListener('click', closeModal);
    backdrop.addEventListener('click', closeModal);
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') closeModal();
    });
</script>
{% endblock %}