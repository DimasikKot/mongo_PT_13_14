{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2>–û—Ç—á—ë—Ç—ã</h2>

    <form method="get" id="reportForm">
        <div class="md-textfield" style="display: inline-block; width: 300px; margin-right: 16px;">
            <select name="type" id="reportType" required>
                <option value="" disabled {% if not type %}selected{% endif %}>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                <option value="cheap" {% if type == "cheap" %}selected{% endif %}>–î–µ—à—ë–≤—ã–µ –ø–∏—Ü—Ü—ã</option>
                <option value="expensive" {% if type == "expensive" %}selected{% endif %}>–î–æ—Ä–æ–≥–∏–µ –ø–∏—Ü—Ü—ã</option>
                <option value="fast" {% if type == "fast" %}selected{% endif %}>–ë—ã—Å—Ç—Ä—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã</option>
                <option value="low" {% if type == "low" %}selected{% endif %}>–ú–∞–ª–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤</option>
            </select>
        </div>

        <div class="md-textfield" style="display: inline-block; width: 280px;">
            <input type="number" name="value" id="valueInput" 
                   value="{% if value %}{{ value }}{% endif %}" 
                   placeholder=" " min="1" required>
            <label id="valueLabel">
                {% if type == "cheap" %}–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (‚ÇΩ)
                {% elif type == "expensive" %}–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (‚ÇΩ)
                {% elif type == "fast" %}–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (–º–∏–Ω)
                {% elif type == "low" %}–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª-–≤–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
                {% else %}–ó–Ω–∞—á–µ–Ω–∏–µ{% endif %}
            </label>
        </div>
    
        <button type="submit" class="md-button md-button--primary" style="display: inline-block; vertical-align: top;">
            –°–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç
        </button>
    
        {% if result is not none and result %}
        <div style="display: inline-block; margin-left: 16px; vertical-align: top;">
            <a href="{% url 'reports_pdf' %}?type={{ type }}&value={{ value }}"
               class="md-button md-button--primary"
               target="_blank">
                üìÑ –°–∫–∞—á–∞—Ç—å PDF
            </a>
        </div>
        {% endif %}
    </form>

    {% if error %}
    <p style="color: var(--md-error); margin-top: 24px;">{{ error }}</p>
    {% endif %}

    {% if result is not none %}
        {% if result %}
            <table border="1" style="border-collapse: collapse; margin-top: 32px; width: 100%;">
                <thead>
                    <tr>
                        {% for key in result.0.keys %}
                            <th style="padding: 12px; text-align: left; background: #f5f5f5;">{{ key }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in result %}
                        <tr>
                            {% for value in row.values %}
                                <td style="padding: 12px;">{{ value }}</td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p style="margin-top: 24px;">–ü–æ –∑–∞–¥–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
        {% endif %}
    {% endif %}
</div>

<script>
    // –¢–æ—Ç –∂–µ JavaScript, —á—Ç–æ –∏ —Ä–∞–Ω—å—à–µ ‚Äî –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ
    document.getElementById('reportType').addEventListener('change', function() {
        const label = document.getElementById('valueLabel');

        switch(this.value) {
            case 'cheap':
                label.textContent = '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (‚ÇΩ)';
                break;
            case 'expensive':
                label.textContent = '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (‚ÇΩ)';
                break;
            case 'fast':
                label.textContent = '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (–º–∏–Ω)';
                break;
            case 'low':
                label.textContent = '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª-–≤–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤';
                break;
            default:
                label.textContent = '–ó–Ω–∞—á–µ–Ω–∏–µ';
        }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', function() {
        const select = document.getElementById('reportType');
        if (select.value) {
            select.dispatchEvent(new Event('change'));
        }
    });
</script>
{% endblock %}
